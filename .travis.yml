language: julia
sudo: true
dist: trusty
os:
  #- linux
    - osx
addons:
    apt:
        packages:
            - xvfb
            - xauth
            - libgtk-3-0
    homebrew:
      packages:
#        - xquartz
        - gtk+3
      brewfile: true
      update: true
julia:
  #- 0.7
    - 1.0
      #  - 1.1
      #- nightly
notifications:
  email: false

before_install:
    - if [ "${TRAVIS_OS_NAME}" = "osx" ]; then 
          ( sudo Xvfb :99 -ac -screen 0 1024x768x8; echo ok )&
      fi

script:
    - if [[ -a .git/shallow ]]; then git fetch --unshallow; fi
    - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then 
          xvfb-run julia -e 'using Pkg; Pkg.test("ImageView")';
      elif [ "${TRAVIS_OS_NAME}" = "osx" ]; then 
          julia -e 'using Pkg; Pkg.test("ImageView")'; fi

after_success:
    - julia --color=yes -e 'using Pkg; Pkg.add("Coverage"); using Coverage; Codecov.submit(process_folder())'
