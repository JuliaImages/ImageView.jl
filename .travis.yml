language: julia
sudo: true
dist: trusty
os: osx
addons:
  homebrew:
    packages:
    - gtk+3
julia:
  - 1.0
notifications:
  email: false

before_script:
  - if [ "${TRAVIS_OS_NAME}" = "osx" ]; then
        ( sudo Xvfb :99 -ac -screen 0 1024x768x8; echo ok; )&
    fi
  - if [ "${TRAVIS_OS_NAME}" = "osx" ]; then
        julia -e 'using Pkg; Pkg.add("Homebrew"); using Homebrew; Homebrew.brew(`switch glib 2.58.3`)';
    fi
    
# install specific glib version using Homebrew.jl; see https://github.com/JuliaGraphics/Cairo.jl/issues/271
script:
  - if [[ -a .git/shallow ]]; then git fetch --unshallow; fi
  - julia -e 'using Pkg; Pkg.build()'
  - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then 
        xvfb-run julia -e 'using Pkg; Pkg.test(coverage=true)';
    elif [ "${TRAVIS_OS_NAME}" = "osx" ]; then 
        julia -e 'using Pkg; Pkg.test(coverage=true)'; fi

after_success:
    - julia --color=yes -e 'using Pkg; Pkg.add("Coverage"); using Coverage; Codecov.submit(process_folder())'
